<apex:page standardController="Contact" extensions="OpportunityPartnerAccountChangeCtrl" title="Account
 of the contact is changed" action="{!updateContact}">
    
    <apex:sectionHeader title="Contact" subtitle="{!Contact.name}"/>
    <apex:form > 
    
    <apex:pageBlock rendered="{!DisplayNoOpenOpportunity}">
            <table width="600px" cellpadding="0" cellspacing="0" border="0">
                <tr>
                    <td><br></br>
                       <div> <apex:pageMessage severity="Info" strength="3" title="Message"   
                       detail="This contact does not have open opportunities "/>
                        </div>
                    </td>
                </tr>
            </table>
        </apex:pageBlock>
        
        <apex:pageBlock rendered="{!DisplayNoClosedOpportunity}">
            <table width="600px" cellpadding="0" cellspacing="0"  border="0">
                <tr>
                    <td><br></br>
                       <div> <apex:pageMessage severity="Info" strength="3" title="Message"   
                       detail="This contact does not have closed opportunities "/>
                        </div>
                    </td>
                </tr>
            </table>
        </apex:pageBlock>      
      
         
        <apex:actionFunction name="oppTMDelete" action="{!removeOTMsExceptSysEngOfOpps}" oncomplete="recursion()" rerender="script, msg" status="status" />
        <apex:actionFunction name="changePartnerAccountAF" action="{!changePartnerAccount}" oncomplete="recursion()" rerender="script, msg" status="status" />
        <apex:actionFunction name="updateContactField" action="{!updateContactobj}" status="status" />
         
        <apex:OutputPanel id="script">
            <script type="text/javascript">
            
                function recursion(){
                    if({!recordExistsFurther} && !{!isError}){
                        oppTMDelete();  
                    }
                    else {
                    	                              
                        if({!opprecordExistsFurther}  && !{!isError}){
                        	changePartnerAccountAF();
                    	}
                    	else{
                    		if(!{!isError}){
                    			updateContactField();
                    		}
                    		
                    	}
                    } 
                } 
                 
            </script>
        </apex:OutputPanel> 
               
        <apex:pageBlock title="Account of the contact is changed" rendered="{!DisplayOptionScreen}">
            <apex:pageMessages id="msg"/>
            <apex:pageBlockSection columns="1" collapsible="false"
                                   title="Please select any one or both of the options to move the opportunities to new account">         
                <apex:selectCheckboxes value="{!SelectedOptions}" layout="pageDirection">
                    <apex:selectOptions value="{!Options}"/>
                    </apex:selectCheckboxes>                
                </apex:pageBlockSection>            
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton value="GO" action="{!removeOTMsExceptSysEngOfOpps}"  status="status" reRender="script, msg" oncomplete="recursion()"/>
                <apex:commandButton value="Cancel" action="{!Cancel}" />
            </apex:pageBlockButtons>
            <apex:actionStatus id="status" startText="Processing..."/> 
        </apex:pageBlock>
    
        <apex:pageBlock rendered="{!DisplayNoPartnerUserMessage}">
            <table width="600px" cellpadding="0" cellspacing="0" align="center" border="0">
                <tr>
                    <td><br></br>
                       <div> <apex:pageMessage severity="Info" strength="3" title="Message"   
                       detail="This contact does not have a partner user"/>  
                                <table align="center">
                                    <tr><td>
                                         <apex:commandButton action="{!Cancel}"  value="Back"  />                            
                                    </td></tr>
                                </table>
                            </div>
                    </td>
                </tr>
            </table>
        </apex:pageBlock>
    
        <apex:pageBlock rendered="{!DisplayNoOpportunityMessage}">
            <table width="600px" cellpadding="0" cellspacing="0" align="center" border="0">
                <tr>
                    <td><br></br>
                       <div> <apex:pageMessage severity="Info" strength="3" title="Message"   
                       detail="This contact does not have opportunities OR The  'Partner Account' 
                       of the opportunities and the contact's account is the same"/>  
                                <table align="center">
                                    <tr><td>
                                         <apex:commandButton action="{!Cancel}" value="Back"  />                            
                                    </td></tr>
                                </table>
                            </div>
                    </td>
                </tr>
            </table>
        </apex:pageBlock>        
    </apex:form>
</apex:page>