@isTest 
public class AccountSuggestionIntegrationTest {
    @testSetup static void setup() {
        OWD__c owdSetting = new OWD__c();
        owdSetting.Oppty_Stage1__c = 'Plan - 1%';
        owdSetting.Oppty_Stage10__c = 'Discover - 10%';
        owdSetting.Oppty_Stage30__c = 'Qualify - 30%';
        owdSetting.Oppty_Stage60__c = 'Propose - 60%'; 
        owdSetting.Oppty_Stage90__c = 'Commit - 90%';
        owdSetting.Oppty_Stage99__c = 'Order Submitted - 99%';
        owdSetting.Oppty_Stage100__c = 'Win - 100%';
        owdSetting.Oppty_Stage0__c = 'Lost, Cancelled - 0%';
        Insert owdSetting;
        TriggerExecutionController.setSkipAllTriggers(true);
        User newUser = [Select Id, Name From User Where IsActive = true and ProfileId =: '00e30000000nJ6K' and Profile.UserLicense.Name = 'Salesforce' and Profile.Name = 'System Administrator' AND username like '%aa_globalsysadmin@dell.com%' limit 1];
        list<Account> listAccTdf=TestDataFactory.createNAccount(1, 'End-User Account');
        listAccTdf[0].Suggestion_ID__c = '131025787';
        listAccTdf[0].Account_Country_Code__c ='IN';
        listAccTdf[0].Status__c = 'U';
        listAccTdf[0].ownerid = newUser.id;
        listAccTdf[0].Account_ID__c ='131026787';
        insert listAccTdf;
        list<Opportunity> listOppTdf=TestDataFactory.createNOpportunities(1, 'Standard Opportunity');
        insert listOppTdf;
        TriggerExecutionController.setSkipAllTriggers(false);
    }
    public static testMethod void testcreateAccountSuggestion(){
        Sales_Channel_Group__c salesGroupObj= new Sales_Channel_Group__c(Name='AMER', Group_id__c='100053708');
        insert salesGroupObj;
        country__c countryObj = new Country__c(Name ='test', Code__c='IN');
        insert countryObj;
        User newUser1 = [Select Id, Name From User Where IsActive = true and ProfileId =: '00e30000000nJ6K' and Profile.UserLicense.Name = 'Salesforce' and Profile.Name = 'System Administrator' AND username like '%aa_globalsysadmin@dell.com%' limit 1];
        LeadTestData.iNumberOfLeads = 1;
        LeadTestData.bCreate = false;
        LeadTestData.createDirectLead2();
        lead testLead = LeadTestData.lstLeads[0];
        
        testLead.Territory_assignment__c =salesGroupObj.id; 
        testLead.ownerid = newUser1.id;
        testLead.physical_country__c = countryObj.id;
        testLead.Street='Test';
        insert testLead;
        list<Opportunity> listOpp=[select id from Opportunity Limit 1];
        set<id> setIds=new set<id>{listOpp[0].id};
            system.assertEquals(setIds.size(), 1);
        Test.startTest();
        System.runAs(newUser1) { 
            list<Account> listAcc=[select id,ownerid,Name,Status__c,Account_Country_Code__c,Account_ID__c,Suggestion_ID__c from Account limit 1];
            HttpRequest req= AccountSuggestionIntegration.createHttpRequestHeader('CreateAccount'); 
            string strresponse = AccountSuggestionIntegration.createAccountsuggestionHTTPRequestBodyString(testLead,false);
            Test.setMock(HttpCalloutMock.class, new Affinity_MockHttpResponseGenerator());  
            string stractivationResponse = AccountSuggestionIntegration.createActivateAccountHTTPRequestBodyString(listAcc[0]);
            AccountSuggestionIntegration.activateAccountInAffinity(setIds);
            string strerrorResponse = '<?xml version="1.0" encoding="UTF-8"?><s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Header><X-OPNET-Transaction-Trace xmlns="http://opnet.com">0c2c06d9-3ab6-41d3-a8d8-b1a6f0bce5ca-1892-213</X-OPNET-Transaction-Trace></s:Header><s:Body><CreateAccountResponse xmlns="CIL"><CreateAccountResult i:type="b:TxRemarks" xmlns:b="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:a="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common.Response"><b:MDMError><b:Message>SalesRep RRID/BadgeNumber is Invalid</b:Message><b:SearchStatus>WARNING</b:SearchStatus></b:MDMError><b:Requester>Authenticated User</b:Requester><b:TxStatusCode>SUCCESS</b:TxStatusCode></CreateAccountResult></CreateAccountResponse></s:Body></s:Envelope>';
            AccountSuggestionResponse response = AccountSuggestionResponse.parseResponseString(strerrorResponse);
            string strsuggestionResponse='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Header><X-OPNET-Transaction-Trace xmlns="http://opnet.com">0aba6457-6720-41ea-82eb-07af0c57e324-8120-663</X-OPNET-Transaction-Trace></s:Header><s:Body><CreateAccountResponse xmlns="CIL"><CreateAccountResult i:type="b:TxRemarks" xmlns:b="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:a="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common.Response"><a:CommonSearchResponse><a:CommonSearchResponseBObj i:type="c:SuggestionResponseBObj" xmlns:c="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Account.Response"><c:SuggestionID>131019610</c:SuggestionID></a:CommonSearchResponseBObj></a:CommonSearchResponse><b:Requester>Authenticated User</b:Requester><b:TxStatusCode>SUCCESS</b:TxStatusCode></CreateAccountResult></CreateAccountResponse></s:Body></s:Envelope>';
            AccountSuggestionResponse sugResponse = AccountSuggestionResponse.parseResponseString(strsuggestionResponse);
            string strduplicateResponse ='<?xml version="1.0" encoding="UTF-8"?><s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Header><X-OPNET-Transaction-Trace xmlns="http://opnet.com">ef464e69-a4c8-47df-b96f-50e66ce9a481-2628-21</X-OPNET-Transaction-Trace></s:Header><s:Body><CreateAccountResponse xmlns="CIL"><CreateAccountResult i:type="b:TxRemarks" xmlns:b="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:a="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common.Response"><a:CommonSearchResponse><a:CommonSearchResponseBObj i:type="c:AccountBasicSearchResponseBObj" xmlns:c="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Account.Response"><c:AccountId>2718678733</c:AccountId><c:AccountName>test123jyothi</c:AccountName><c:AccountStatus>ACTIVE</c:AccountStatus><c:AccountType>ACCOUNT</c:AccountType><c:Country>US</c:Country><c:city>US</c:city><c:state>US</c:state><c:postalCode>xyz</c:postalCode><c:DMU>Y</c:DMU><c:OOB>N</c:OOB></a:CommonSearchResponseBObj></a:CommonSearchResponse><b:Requester>Authenticated User</b:Requester><b:TxStatusCode>SUCCESS</b:TxStatusCode></CreateAccountResult></CreateAccountResponse></s:Body></s:Envelope>';
            AccountSuggestionResponse dupResponse = AccountSuggestionResponse.parseResponseString(strduplicateResponse);
            string strfaultString ='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"> <s:Body> <s:Fault> <faultcode xmlns:a="http://schemas.microsoft.com/net/2005/12/windowscommunicationfoundation/dispatcher">a:DeserializationFailed</faultcode><Text>xyz</Text><faultstring xml:lang="en-US">The formatter threw an exception while trying to deserialize the message: There was an error while trying to deserialize parameter CIL:request. The InnerException message was "There was an error deserializing the object of type DELL.HT.BusinessModel.Account.Request.CreateAccountRequestBObj. The value "suiyee" cannot be parsed as the type "Int64".".  Please see InnerException for more details.</faultstring> <detail> <ExceptionDetail xmlns="http://schemas.datacontract.org/2004/07/System.ServiceModel" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"> <HelpLink i:nil="true"/> <InnerException> <HelpLink i:nil="true"/> <InnerException> <HelpLink i:nil="true"/> <InnerException> <HelpLink i:nil="true"/> <InnerException i:nil="true"/> <Message>Input string was not in a correct format.</Message> <StackTrace>at System.Number.StringToNumber(String str, NumberStyles options, NumberBuffer&amp; number, NumberFormatInfo info, Boolean parseDecimal) at System.Number.ParseInt64(String value, NumberStyles options, NumberFormatInfo numfmt) at System.Xml.XmlConverter.ToInt64(String value)</StackTrace> <Type>System.FormatException</Type> </InnerException> <Message>The value "suiyee" cannot be parsed as the type "Int64".</Message> <StackTrace>at System.Xml.XmlConverter.ToInt64(String value) at System.Xml.XmlConverter.ToInt64(Byte[] buffer, Int32 offset, Int32 count) at System.Xml.ValueHandle.ToLong() at System.Xml.XmlBaseReader.ReadContentAsLong() at System.Xml.XmlDictionaryReader.ReadElementContentAsLong() at ReadAccountSalesRepInfoFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString[] , XmlDictionaryString[] ) at System.Runtime.Serialization.ClassDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context) at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, Type declaredType, DataContract&amp; dataContract) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Int32 id, RuntimeTypeHandle declaredTypeHandle, String name, String ns) at ReadArrayOfAccountSalesRepInfoFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString , XmlDictionaryString , CollectionDataContract ) at System.Runtime.Serialization.CollectionDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context) at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, Type declaredType, DataContract&amp; dataContract) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Int32 id, RuntimeTypeHandle declaredTypeHandle, String name, String ns) at ReadCreateAccountRequestBObjFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString[] , XmlDictionaryString[] ) at System.Runtime.Serialization.ClassDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context) at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, Type declaredType, DataContract&amp; dataContract) at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Type declaredType, DataContract dataContract, String name, String ns) at System.Runtime.Serialization.DataContractSerializer.InternalReadObject(XmlReaderDelegator xmlReader, Boolean verifyObjectName, DataContractResolver dataContractResolver) at System.Runtime.Serialization.XmlObjectSerializer.ReadObjectHandleExceptions(XmlReaderDelegator reader, Boolean verifyObjectName, DataContractResolver dataContractResolver)</StackTrace> <Type>System.Xml.XmlException</Type> </InnerException> <Message>There was an error deserializing the object of type DELL.HT.BusinessModel.Account.Request.CreateAccountRequestBObj. The value "suiyee" cannot be parsed as the type "Int64".</Message> <StackTrace>at System.Runtime.Serialization.XmlObjectSerializer.ReadObjectHandleExceptions(XmlReaderDelegator reader, Boolean verifyObjectName, DataContractResolver dataContractResolver) at System.Runtime.Serialization.DataContractSerializer.ReadObject(XmlDictionaryReader reader, Boolean verifyObjectName) at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.PartInfo.ReadObject(XmlDictionaryReader reader, XmlObjectSerializer serializer) at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameterPart(XmlDictionaryReader reader, PartInfo part, Boolean isRequest)</StackTrace> <Type>System.Runtime.Serialization.SerializationException</Type> </InnerException> <Message>The formatter threw an exception while trying to deserialize the message: There was an error while trying to deserialize parameter CIL:request. The InnerException message was "There was an error deserializing the object of type DELL.HT.BusinessModel.Account.Request.CreateAccountRequestBObj. The value "suiyee" cannot be parsed as the type "Int64".".  Please see InnerException for more details.</Message> <StackTrace><![CDATA[at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameterPart(XmlDictionaryReader reader, PartInfo part, Boolean isRequest) at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameter(XmlDictionaryReader reader, PartInfo part, Boolean isRequest) at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameters(XmlDictionaryReader reader, PartInfo[] parts, Object[] parameters, Boolean isRequest) at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeBody(XmlDictionaryReader reader, MessageVersion version, String action, MessageDescription messageDescription, Object[] parameters, Boolean isRequest) at System.ServiceModel.Dispatcher.OperationFormatter.DeserializeBodyContents(Message message, Object[] parameters, Boolean isRequest) at System.ServiceModel.Dispatcher.OperationFormatter.DeserializeRequest(Message message, Object[] parameters) at System.ServiceModel.Dispatcher.DispatchOperationRuntime.DeserializeInputs(MessageRpc& rpc) at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc& rpc) at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc& rpc) at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)]]></StackTrace> <Type>System.ServiceModel.Dispatcher.NetDispatcherFaultException</Type> </ExceptionDetail> </detail> </s:Fault> </s:Body> </s:Envelope> ';
            AccountSuggestionResponse faultResponse = AccountSuggestionResponse.parseResponseString(strfaultString);
            string strupdateResponse ='<?xml version="1.0" encoding="UTF-8"?><s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Header><X-OPNET-Transaction-Trace xmlns="http://opnet.com">0c2c06d9-3ab6-41d3-a8d8-b1a6f0bce5ca-1892-213</X-OPNET-Transaction-Trace></s:Header><s:Body><UpdateAccountResponse xmlns="CIL"><UpdateAccountResult i:type="b:TxRemarks" xmlns:b="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:a="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common.Response"><b:MDMError><b:Message>SalesRep RRID/BadgeNumber is Invalid</b:Message><b:SearchStatus>WARNING</b:SearchStatus></b:MDMError><b:Requester>Authenticated User</b:Requester><b:TxStatusCode>SUCCESS</b:TxStatusCode></UpdateAccountResult></UpdateAccountResponse></s:Body></s:Envelope>';
            AccountSuggestionResponse updateResp = AccountSuggestionResponse.parseResponseString(strupdateResponse);
            string strerrResponse='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Header><X-OPNET-Transaction-Trace xmlns="http://opnet.com">0aba6457-6720-41ea-82eb-07af0c57e324-8120-663</X-OPNET-Transaction-Trace></s:Header><s:Body><CreateAccountResponse xmlns="CIL"><CreateAccountResult i:type="b:TxRemarks" xmlns:b="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:a="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Common.Response"><a:CommonSearchResponse><a:CommonSearchResponseBObj i:type="c:SuggestionResponseBObj" xmlns:c="http://schemas.datacontract.org/2004/07/DELL.HT.BusinessModel.Account.Response"><c:Error>131019610</c:Error></a:CommonSearchResponseBObj></a:CommonSearchResponse><b:Requester>Authenticated User</b:Requester><b:TxStatusCode>SUCCESS</b:TxStatusCode></CreateAccountResult></CreateAccountResponse></s:Body></s:Envelope>';
            AccountSuggestionResponse errResp = AccountSuggestionResponse.parseResponseString(strerrResponse);
        }
        Test.stopTest();
    }
}