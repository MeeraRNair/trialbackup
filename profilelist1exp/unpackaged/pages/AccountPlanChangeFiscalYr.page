<apex:page showHeader="true" extensions="AccountPlanChangeFiscalYrCtrlr" standardController="SFDC_Acct_Plan__c" standardStylesheets="false" >
    <apex:form >
        <table width="100%" height="10" cellpadding="4" cellspacing="0" border="0" style="border: 1px #CC3300 solid;">
            <tr>
                <td bgcolor='#f6a828' width="100%" style="font-family: verdana, arial; font-size: 15pt; font-weight: bold; color: #FFFFFF">Change Fiscal year - Please note!
                </td>
            </tr>
        </table>
        <br/>

        <apex:outputPanel rendered="{!!ISNULL(messages)}">
            
            <apex:outputPanel rendered="{!IF(isException==true,true,false)}" > 
                <apex:PageMessage escape="false" title="Error:" summary="{!exceptionMessageTitle}" detail="{!exceptionMessageDetail}" severity="error" strength="3" id="msgBlock1" />
            </apex:outputPanel>
            
            <apex:outputPanel rendered="{!IF(isException!=true,true,false)}">
                <apex:PageMessages id="msgBlock" />
            </apex:outputPanel>
            
            <center>
                <apex:commandButton value="Back" style="width:50px"
                action="{!changeFY_No}" />
            </center>

        </apex:outputPanel>

    

        <apex:outputPanel rendered="{!ISNULL(messages)}">
            <apex:outputPanel rendered="{!IF((planningyear<16)||planningyear>=nextFiscalYear ,false,true)}" style="font-size:10pt;">
                <br />
               <!-- <table align="center" style="margin-left: auto; margin-right: auto;" >-->
               <table align="center">
                    <tr>
                        <td>Make sure you manage/align your Strategies and Opportunities:<br/>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;–&nbsp;&nbsp;&nbsp;All Strategies with the current FY or beyond will move across to your new Plan,  includes linked Opportunities<br/>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;–&nbsp;&nbsp;&nbsp;(Any Strategies with a previous FY will not move)<br/>
                            All objects (e.g. Activities, Trip Reports) related to the Plan will also move across and be visible to you also adding the Partner detailing record and the enablement record for Partner business plans<br/><br/>
                            Make sure you validate/change the name of the new plan

                        <br /> 
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr>
                    <td>
                    <table align="left">
                    <tr>
                    <td>
                    <label for="accPlanNam1"><b>New Account Plan Name:</b></label>
                    </td>
                    <td><apex:inputField styleClass="requiredInput" required="true" value="{!accPlan.Name}" id="accPlanNam1" /><br /> <br /></td>
                    </tr>
                    <tr align="center">
                                <td colspan="2">
                                Confirm FY change <br /> <br />
                                </td>
                                <td>
                                </td>
                                </tr>
                                <tr align="center">
                                <td colspan="2">
                                <apex:commandButton value="Yes" style="width:50px" onclick="yesMessage()" rerender="msgBlock,msgBlock1" />
                    <apex:actionFunction name="afterCloning" action="{!changeFY_Yes}" />
                    
                    <script>
                    
                    function yesMessage(){
                        alert('Change Fiscal Year in progress. On success, you will be redirected to the new Account Plan Record');
                        afterCloning();
                    }
                    
                    </script>
                    
                    <apex:commandButton value="No" style="width:50px"
                        action="{!changeFY_No}" />
                                </td>
                                </tr>
                    </table>
                    </td>
                    </tr>
               </table>
               
               
           </apex:outputpanel>
            <apex:outputPanel rendered="{!IF(planningyear<16,true,false)}" style="font-size:10pt;align:center;">
                <br />
                <br />
                    <apex:pageMessage title="Error:" summary="For plans with a planning year earlier than FY16 please use the Cloning functionality." severity="Error" strength="3" />
                <br />
                <br />
                <br />
                <center>
                    <apex:commandButton value="Back" action="{!changeFY_No}" />
                </center>
            </apex:outputpanel>

            <apex:outputPanel rendered="{!IF(planningyear>=nextFiscalYear,true,false)}" style="font-size:10pt;align:center;">
                <br />
                <br />
                    <apex:pageMessage title=" Error:" summary="You can only change the FY of your Account Plan once the new FY has started ; continue to update your plan until EOY and then change the FY" severity="error" strength="3" />
                <br />
                <br />
                <br />
                <br />
                <center>
                    <apex:commandButton value="Back" action="{!changeFY_No}" />
                </center>
            </apex:outputpanel>
              
        </apex:outputPanel>
    </apex:form>
</apex:page>