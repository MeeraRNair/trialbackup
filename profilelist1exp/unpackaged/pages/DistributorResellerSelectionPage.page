<apex:page standardController="opportunity" extensions="Vfcntrl_DistributorResellerSelectionExt" sidebar="false" showHeader="false" action="{!onPageLoad}" lightningStylesheets="true" >
    <apex:form id="frm" >
        <apex:actionFunction action="{!goBack}" name="callGoBack" oncomplete="alert('Executed')"/>
        <apex:stylesheet value="{!URLFOR($Resource.PageBlockTableEnhanceResources, 'css/jquery.dataTables.css')}"/>
        <style type="text/css">
.sorting {
    background: #f2f3f3 url('{! URLFOR($Resource.PageBlockTableEnhanceResources, 'images/sort_both.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_asc {
    background: #f2f3f3 url('{! URLFOR($Resource.PageBlockTableEnhanceResources, 'images/sort_asc.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_desc {
    background: #f2f3f3 url('{! URLFOR($Resource.PageBlockTableEnhanceResources, 'images/sort_desc.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_asc_disabled {
    background: #f2f3f3 url('{! URLFOR($Resource.PageBlockTableEnhanceResources, 'images/sort_asc_disabled.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_desc_disabled {
    background: #f2f3f3 url('{! URLFOR($Resource.PageBlockTableEnhanceResources, 'images/sort_desc_disabled.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
table.dataTable tr.odd { background-color: white;border-bottom-width:1px }
table.dataTable tr.even { background-color: white;border-bottom-width:1px }
.bPageBlock .list .last>td { border-bottom-width:1px }
.apexp .bPageBlock .detailList .list .last td { border-bottom-width:1px }
table.dataTable tr.odd td.sorting_1 { background-color: white; }
table.dataTable tr.odd td.sorting_2 { background-color: white; }
table.dataTable tr.odd td.sorting_3 { background-color: white; }
table.dataTable tr.even td.sorting_1 { background-color: white; }
table.dataTable tr.even td.sorting_2 { background-color: white; }
table.dataTable tr.even td.sorting_3 { background-color: white; }
.dataTables_length, .dataTables_filter, .dataTables_info, .dataTables_paginate {
    padding: 3px;
}

.backgroundColorClass {
    background-color: orange;
}
</style>
        <style>
    .activeTab {background-color: white; color:black;font-size:17px;
    background-image:none}
    .inactiveTab { background-color: lightgrey; color:grey;font-size:15px;
    background-image:none}
    .background { background-color: white; font-size:12px; color:black}
</style>
        <style>
    h1{
    font-size: 100%;
      }   
</style>
        <style type="text/css">   
        .imgclass:hover{   
            background-image: url(/img/help/helpOrbs.gif);   
            background-repeat: no-repeat;   
            width: 16px;   
            height: 15px;      
            background-position: right;  
            
          
        }   
        .imgclass{   
            background-image: url(/img/help/helpOrbs.gif);   
            background-repeat: no-repeat;   
            width: 16px;   
            height: 15px;   
             
        }   
    </style>
          <apex:outputPanel rendered="{!! showSubmittedSection && showError}" >
        <apex:pageMessages id="msgg" escape="false" />       
        <apex:commandButton onclick="refreshPage()"  Value="{!$Label.Back_to_Opportunity}" />
        <script>
        function refreshPage()
        {
        if( (typeof sforce != 'undefined') && (sforce != null) ) {
         callGoBack();
         console.log("Action Function Has Called");
        }
        else{
        window.close();
        }
        }       
        </script>  
                         
    </apex:outputPanel>
    
  <!---Below section will be displayed if preferred distributor setup request is already submitted---->
    <apex:outputPanel rendered="{!showSubmittedSection}">
    <apex:pageMessages />
        <apex:pageblock title="{!$Label.Dell_EMC_Preferred_Distributor_Setup_Request}">
            <apex:pageBlockSection columns="1">
                <apex:pageblocksectionitem >
                    <apex:outputLabel value="{!$Label.Deal_Reg_Distributor_Switch_Requested_Distributor_By}" />
                    <apex:outputField value="{!contractedDisti[0].Requested_Distributor_By__c}"/>               
                </apex:pageblocksectionitem>
                <apex:pageblocksectionitem >
                    <apex:outputLabel value="{!$Label.Deal_Reg_Distributor_Switch_Requested_Distributor_Date}" />
                    <apex:outputField value="{!contractedDisti[0].Requested_Distributor_Date__c}"/>               
                </apex:pageblocksectionitem> 
                <apex:pageblocksectionitem >
                    <apex:outputLabel value="{!$Label.Deal_Reg_Distributor_Switch_Requested_Distributor_Status}" />
                    <apex:outputField value="{!contractedDisti[0].Requested_Distributor_Status__c}"/>               
                </apex:pageblocksectionitem> 
            </apex:pageBlockSection>   
            <apex:pageBlockButtons location="Bottom">
               <apex:commandButton onclick="refreshPage()"  Value="{!$Label.ok}" />
                <script>
                function refreshPage()
                {
                if( (typeof sforce != 'undefined') && (sforce != null) ) {
                 callGoBack();
                 console.log("Action Function Has Called");
                }
                else{
                window.close();
                }
                }               
                </script>                                                                                                      
            </apex:pageBlockButtons>
        </apex:pageblock>
    </apex:outputPanel> 
    
               <apex:outputPanel rendered="{! !showError}">

            <apex:tabpanel id="tabPanel" switchType="client" value="{!selectedTab}"  tabClass="activeTab" inactiveTabClass="inactiveTab" >
                <apex:tab label="{!$Label.Select_Distributor_Reseller_Account}" id="Accounttab" name="Accountselectiontab" ontabenter="callbacktoAccountSearch()" rendered="{!!isTier1}" >

                    <apex:outputpanel rendered="{! !showContctAddtionSection}" id="pb0">
                        <apex:pageBlock title="{!IF(isDistributor == true, $Label.Find_a_Regional_Distributor_or_Reseller, $Label.Find_a_Distributor_or_Regional_Distributor)}" rendered="{!isAccountSearchValid==true}">
                            <!-- pageBlocklabel -->
                            <apex:pageBlockSection title="{!IF(isDistributor == true, $Label.Locate_a_Regional_Distributor_or_Reseller_near_you, $Label.Locate_a_Distributor_or_Regional_Distributor_near_you)}" collapsible="false" columns="1"  >
                                 <apex:pageblocksectionitem >
                                    <apex:outputlabel value="{!$Label.Regional_Distributor_Lookup_Message}" />
                                  </apex:pageblocksectionitem>
                                <apex:pageblockSectionItem >
                                    <apex:outputLabel value="{!$Label.DistributororReseller_name}"/ >
                                        <apex:outputText value="{!distributorName}" />
                                    </apex:pageblocksectionItem>
                                      <apex:pageblockSectionItem helpText="..." >
                                                                             

                                          <apex:outputLabel value="{!$Label.Fulfilmentpath}">
                                          <!--   <img src="/s.gif" id="HelpImage" alt="{!$Label.FulfilmentPath_Helptext}" class="infoIcon" title= "{!$Label.FulfilmentPath_Helptext}"/>   -->
                                           <img src="/s.gif" Class="imgclass" title= "{!$Label.FulfilmentPath_Helptext}"/>  
                                             </apex:outputLabel>
                                       <apex:outputText value="{!oppRecord.Distributor_Name__c}"></apex:outputText>    
                                      </apex:pageblockSectionItem>     
                                    <apex:pageblockSectionItem rendered="{!isTier1orTier2 || isTier1}" >
                                            <apex:outputLabel value="{!$Label.Account_Country}"/>
                                            <apex:outputText value="{!loggedInUserCountry}"></apex:outputText>
                                        </apex:pageblockSectionItem>
                                        <apex:pageblockSectionItem rendered="{!isTier1orTier2 || isTier1}"   >
                                            <apex:outputLabel value="{!$Label.End_User_Mailing_Country}"/>
                                           <apex:outputText value="{!oppRecord.End_User_Mailing_Country__c}"></apex:outputText> 
                                         </apex:pageblockSectionItem>
                                         <apex:pageblocksectionitem /><apex:pageblocksectionitem />
                                        <apex:pageblockSectionItem rendered="{!isDistributor}"  >
                                           <apex:outputLabel value="{!$Label.Distributor_Authorized_Countries}"/>
                                           <apex:selectList value="{!selectedDistiCountry}" size="1" multiselect="false" >
                                            <apex:selectOptions value="{!distiCountriesdropdown}" />
                                            </apex:selectList> 
                                        </apex:pageblockSectionItem> 
                                     <apex:pageblockSectionItem >
                                        <apex:outputLabel value="{!$Label.Search_By}"/>
                                        <apex:selectList value="{!accName}" size="1"  required="false" >
                                            <apex:selectOption itemLabel="{!IF(isDistributor == true && bisSubDistributor==false, $Label.Reseller_Email_Address, $Label.Distributor_Email_Address)}" itemValue="Email" />
                                            <apex:selectOption itemLabel="{!IF(isDistributor == true && bisSubDistributor==false, $Label.Reseller_Account_Name, $Label.Distributor_Account_Name)}"  itemValue="Name"/>                                             
                                            <apex:selectOption itemLabel="{!IF(isDistributor == true && bisSubDistributor==false, $Label.Reseller_Dell_Affinity_ID, $Label.Distributor_Dell_Affinity_ID)}" itemValue="Affinity"/>   
                                            <apex:selectOption itemLabel="{!IF( bIsStorage==False&& bisSubDistributor==false ,$Label.Regional_Disrtibutor_Email , '')}" itemValue="sEmail"  rendered="{!IF( bIsStorage==False&& bisSubDistributor==false , True, False)}"/>
                                            <apex:selectOption itemLabel="{!IF( bIsStorage==False&& bisSubDistributor==false, $Label.Regional_Disrtibutor_Account_Name, '')}"  itemValue="sName" rendered="{!IF( bIsStorage==False&& bisSubDistributor==false , True, False)}"/>                                             
                                            <apex:selectOption itemLabel="{!IF( bIsStorage==False&& bisSubDistributor==false, $Label.Regional_Distributor_Dell_Affinity_ID, '')}" itemValue="sAffinity" rendered="{!IF( bIsStorage==False&& bisSubDistributor==false , True, False)}"/>                                            
                                        </apex:selectList>
                                        <!-- sub disti search --->

                                        
                                         
                                      </apex:pageblockSectionItem>
                                        <apex:pageblocksectionitem >                                          
                                            <apex:outputLabel value="{!$Label.Keyword}">
                                            <img src="/s.gif" Class="imgclass" title= "{!$Label.SearchByHelpText}"/>
                                             </apex:outputLabel>                                 
                                            <apex:inputText value="{!searchstring}" />  
                                        </apex:pageblocksectionitem> 
                                          <apex:pageblockSectionItem > 
                                              <apex:outputLabel />
                                              <apex:outputlabel >{!$Label.Email_adress_keyword_examples}</apex:outputlabel>
                                           </apex:pageblocksectionitem>  
                                    </apex:pageBlockSection>
                                    <apex:pageBlockButtons location="Bottom" >
                                        <apex:commandButton Value="{!$Label.CMAP_Search}" action="{!fetchResults}"  reRender="frm,pb,errorMsg" status="actStatusId" rendered="{!!hasContractedReseller}" />
                                         <apex:commandButton Value="{!$Label.CMAP_Search}" action="{!fetchContractedResellers}"  reRender="frm,pb,errorMsg" status="actStatusId" rendered="{!hasContractedReseller}" />
                                        <apex:commandButton onclick="refreshPage()"  Value="{!$Label.MDM_CloseButton}" />
                                        <apex:actionStatus id="actStatusId" >
                                            <apex:facet name="start" >
                                                <img src="/img/loading.gif" />
                                            </apex:facet>
                                        </apex:actionStatus>
                                        <script>
                        function refreshPage(){
                        if( (typeof sforce != 'undefined') && (sforce != null) ) {
                             callGoBack();
                             console.log("Action Function Has Called");
                            }
                            else{
                           window.opener.parent.location.href = "/{!$CurrentPage.parameters.id}";
                            window.close();
                        }
                        }                       
                        </script>
                                    </apex:pageBlockButtons>
                                </apex:pageBlock>
                                 <!-- Display below section when account search is not valid -->
                                <apex:pageBlock title="{!IF(isDistributor == true, $Label.Find_a_Regional_Distributor_or_Reseller, $Label.Find_a_Distributor_or_Regional_Distributor)}" rendered="{!!isAccountSearchValid}">
                                    <apex:pageBlockSection title="{!IF(isDistributor == true, $Label.Locate_a_Regional_Distributor_or_Reseller_near_you, $Label.Locate_a_Distributor_or_Regional_Distributor_near_you)}" collapsible="false" columns="1"  >
                                        <apex:pageblockSectionItem >
                                            <apex:outputLabel value="{!$Label.DistributororReseller_name}" />
                                          <!--  <apex:outputText value="{!oppRecord.Distributor_Reseller_Name__r.name}" /> -->
                                            <apex:outputText value="{!distributorName}" />
                                        </apex:pageblockSectionItem>
                                        <apex:pageblockSectionItem >
                                           <!-- <apex:outputLabel value="{!$Label.Fulfilmentpath}"/ >  -->
                                            <apex:outputLabel value="{!$Label.Fulfilmentpath}">
                                                                                    

                                            <img src="/s.gif" Class="imgclass" title= "{!$Label.FulfilmentPath_Helptext}"/>
                                             </apex:outputLabel>
                                                <apex:outputText value="{!oppRecord.Distributor_Name__c}"></apex:outputText>
                                            </apex:pageblockSectionItem>
                                            <apex:pageblockSectionItem rendered="{!isTier1orTier2 || isTier1}" >
                                                <apex:outputLabel value="{!$Label.Account_Country}"/>
                                                <apex:outputText value="{!loggedInUserCountry}"></apex:outputText>
                                            </apex:pageblockSectionItem>
                                          <apex:pageblockSectionItem rendered="{!isTier1orTier2 || isTier1}"   >
                                            <apex:outputLabel value="{!$Label.End_User_Mailing_Country}"/>
                                           <apex:outputText value="{!oppRecord.End_User_Mailing_Country__c}"></apex:outputText> 
                                         </apex:pageblockSectionItem>
                                           <apex:pageblockSectionItem rendered="{!isDistributor}"  >
                                           <apex:outputLabel value="{!$Label.Distributor_Authorized_Countries}"/>
                                           <apex:selectList value="{!selectedDistiCountry}" size="1" multiselect="false" disabled="true" >
                                            <apex:selectOptions value="{!distiCountriesdropdown}" />
                                            </apex:selectList> 
                                         </apex:pageblockSectionItem>   
                                        </apex:pageBlockSection>
                                        <apex:pageBlockButtons location="Bottom" >
                                            <apex:commandButton onclick="refreshPage()"  Value="{!$Label.MDM_CloseButton}" />
                                            <apex:actionStatus id="actStatusId" >
                                                <apex:facet name="start" >
                                                    <img src="/img/loading.gif" />
                                                </apex:facet>
                                            </apex:actionStatus>
                                            <script>
                            function refreshPage(){
                            if( (typeof sforce != 'undefined') && (sforce != null) ) {
                                 callGoBack();
                                 console.log("Action Function Has Called");
                                }
                                else{
                               window.opener.parent.location.href = "/{!$CurrentPage.parameters.id}";
                                window.close();
                            } 
                            }
                            </script>
                                        </apex:pageBlockButtons>
                                    </apex:pageBlock>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{! !showContctAddtionSection }">
                                    <apex:pageMessages id="errorMsg" escape="false"  />
                                    <apex:outputPanel id="pb"  rendered="{!showTable && (isAccountSearchValid || has2distis)}" >
                                        <apex:pageBlock title="{!$Label.search_results}">
                                            <apex:pageblockTable value="{!accList}" var="a" styleClass="dataTable" rendered="{!!hasContractedReseller}">
                                                <apex:column headervalue="{!$Label.AVS_Field_Select}" >
                                                    <input type="radio" name="selectedAccId" value= "{!a.Id}" >
                                                        <apex:actionSupport event="onclick"  rerender="recordSelected" ></apex:actionSupport>
                                                    </input>
                                                </apex:column>
                                                <apex:column headerValue="{!$Label.CMAP_AccountName}">{!a.name}</apex:column>
                                                <apex:column headerValue="{!$Label.AccountName_Local}">{!a.NameLocal}</apex:column>
                                                <apex:column headerValue="{!$Label.Dell_Affinity_ID}">{!a.Account_ID__c}</apex:column>  
                                                <apex:column headerValue="{!$Label.Partner_Program_Name}">{!a.Partner_Type__c}</apex:column>  
                                                <apex:column headerValue="{!$Label.Account_Country}">{!a.Account_Country__c}</apex:column>
                                                <apex:column headerValue="{!$Label.Speciality_Product_Purchase_Path}">{!a.Purchasing_Model__c}</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_city}">{!a.Billingcity}</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_state_province}">{!a.Billingstate }</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_Country}">{!a.BillingCountry}</apex:column>
                                               
                                            </apex:pageblockTable>
                                           
                                          <apex:pageblockTable value="{!distiList}" var="d" styleClass="dataTable" rendered="{!hasContractedReseller}">
                                                <apex:column headervalue="{!$Label.AVS_Field_Select}" >
                                                    <input type="radio" name="selectedAccId" value= "{!d.Reseller_Account__c}" >
                                                        <apex:actionSupport event="onclick"  rerender="recordSelected" ></apex:actionSupport>
                                                    </input>
                                                </apex:column>
                                                <apex:column headerValue="{!$Label.CMAP_AccountName}">{!d.Reseller_Account__r.name}</apex:column>  
                                                <apex:column headerValue="{!$Label.AccountName_Local}">{!d.Reseller_Account__r.NameLocal}</apex:column>
                                                <apex:column headerValue="{!$Label.Dell_Affinity_ID}">{!d.Reseller_Account__r.Account_ID__c}</apex:column>   
                                                <apex:column headerValue="{!$Label.Account_Country}">{!d.Reseller_Account__r.Account_Country__c}</apex:column>
                                                <apex:column headerValue="{!$Label.Speciality_Product_Purchase_Path}">{!d.Reseller_Account__r.Purchasing_Model__c}</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_city}">{!d.Reseller_Account__r.Billingcity}</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_state_province}">{!d.Reseller_Account__r.Billingstate }</apex:column>
                                                <apex:column headerValue="{!$Label.Billing_Country}">{!d.Reseller_Account__r.BillingCountry}</apex:column>
                                                </apex:pageblockTable>
                                           
                                    
                                            <apex:pageBlockButtons location="Bottom">
                                                <apex:outputPanel id="savebutton">
                                                    <apex:commandButton value="{!$Label.Save_Account}" action="{!saveFunction}" reRender="frm" status="actStatusId1"/>
                                                                                               
                                                    <apex:actionStatus id="actStatusId1" >
                                                        <apex:facet name="start" >
                                                            <img src="/img/loading.gif" />
                                                        </apex:facet>
                                                    </apex:actionStatus>
                                                </apex:outputPanel>
                                            </apex:pageBlockButtons>              
                                        </apex:pageBlock>
                                          
                                    </apex:outputPanel>
                                   
                                    <apex:outputpanel rendered="{!showInfoMsg}" >
                                        <apex:pageBlock >
                                            <apex:pageBlockSection columns="1" title="{!$Label.Deal_Auto_Approval_Failed_Then_Manual_Title}" collapsible="false">
                                                <apex:pageBlockSectionItem >
                                                    <h1>{!$Label.Add_Reseller_Distributor_contacts} </h1>
                                                </apex:pageBlockSectionItem>
                                            </apex:pageBlockSection>
                                        </apex:pageBlock>
                         </apex:outputpanel>
                                </apex:outputPanel>
                            </apex:tab>
                            <apex:tab label="{!$Label.Add_Reseller_Contacts}" name="resellerTab" ontabenter="callresellercontactAddition()" rendered="{!!hideResellerContactAddtiontab || isTier1}">
                                <apex:outputPanel rendered="{!showContctAddtionSection}">
                                    <apex:outputPanel id="pb2" >
                                        <apex:pageBlock title="{! $Label.Add_Reseller_Contact}">
                                            <apex:pageblockSection title="{!$Label.Search_Contact}" collapsible="false" columns="1">
                                               <apex:outputPanel >
                                                  {!$Label.Contact_lookup_message}
                                                </apex:outputPanel>
                                               <apex:pageblockSectionItem >
                                                   <apex:outputLabel value="{!$Label.Reseller_Account}" />
                                                    <apex:outputlabel value="{!accountName}" /> 
                                                </apex:pageblockSectionItem> 
                                                <apex:pageblockSectionItem >
                                                    <apex:outputLabel value="{!$Label.T2D_Contact}" />
                                                    <apex:actionRegion >
                                                    <apex:actionFunction name="toggleButton" rerender="resellerButtonPanel"/>
                                                    <apex:inputText value="{!resellercontactSearchString}" disabled="{!isResellerPartneradminchecked}" onkeyup="toggleButton()" />
                                                    </apex:actionRegion>
                                                </apex:pageblockSectionItem>                                               
                                                <apex:pageblockSectionItem > 
                                              <apex:outputLabel />
                                              <apex:outputlabel >{!$Label.contact_email_suggestions}</apex:outputlabel>
                                           </apex:pageblocksectionitem> 
                                                <apex:pageBlockSectionItem >
                                                    <apex:outputLabel value="{!$Label.Display_Partner_Admins}" />
                                                    <apex:inputcheckbox value="{!isResellerPartneradminchecked}" selected="{!isResellerPartneradminchecked}">
                                                        <apex:actionSupport event="onclick" reRender="pb2" />
                                                    </apex:inputcheckbox>
                                                </apex:pageBlockSectionItem>
                                             </apex:pageblockSection>
                                              <apex:pageblockbuttons location="Bottom">
                                                <apex:outputPanel id="resellerButtonPanel">
                                                <apex:commandButton value="{!$Label.CMAP_Search}" action="{!contactSearch}"  reRender="frm,errorMsg" status="actStatusId4" disabled="{!(OR(ISBLANK(resellercontactSearchString), ''== resellercontactSearchString))&& NOT(isResellerPartneradminchecked)}" />
                                                </apex:outputPanel>
                                                <apex:actionStatus id="actStatusId4" >
                                               <apex:facet name="start" >
                                                  <img src="/img/loading.gif" />
                                                   </apex:facet>
                                                </apex:actionStatus>
                                            </apex:pageblockbuttons>
                                        </apex:pageBlock>
                                     </apex:outputPanel>
                                    <apex:pageMessages id="errorMsgg" escape="false"  />
                                    <apex:outputPanel rendered="{!showOppTeamSection}">
                                        <apex:pageBlock id="pb1">
                                            <apex:pageblocksection title="{!$Label.opportunity_Team}" collapsible="false" columns="1" id="oppTeamsId">
                                                <apex:pageBlockSectionItem >
                                                    <apex:outputLabel value="{!$Label.select_tabs_for_contact_addtion}" rendered="{! !IF(reselleroppTeamEdit == false, true, showAddedContactstable)}" />
                                                </apex:pageBlockSectionItem>
                                                <apex:pageBlockSectionItem >
                                                    <apex:pageblockTable value="{!oppTeamMembers}" var="a" styleClass="dataTable" rendered="{!showAddedContactstable}">
                                                        <apex:column headerValue="{!$Label.CMAP_Action}">
                                                            <apex:commandLink value="{!$Label.edit}" action="{!editOppTeamMem}" rerender="pb1,editSec" rendered="{!if(isValidProfile, true,(if(a.TeamMemberRole == 'Reseller Contact',isresellerValidUser, if(a.TeamMemberRole ==  'Distributor Contact',isDistiValidUser,false))))}"   >
                                                                <apex:param name="par" value="{!a.Id}" assignTo="{!ResellerparamOpportunityId}" />
                                                            </apex:commandLink>
                                                            <apex:commandLink value=" | {!$Label.Remove}" onclick="this.onclick=function(){return false;}" action="{!delRow}" rerender="pb1, frm" rendered="{! isValidProfile || isDistiValidUser || isresellerValidUser }" >
                                                                 <apex:param name="par" value="{!a.Id}" assignTo="{!ResellerparamOpportunityId}" />
                                                            </apex:commandLink>
                                                        </apex:column>
                                                        <apex:column headerValue="{!$Label.Team_Member}"> {!a.User.Name} </apex:column>
                                                        <!-- <apex:column headerValue="Contact Phone"> {!a.User.Contact.Phone} </apex:column> -->
                                                        <apex:column headerValue="{!$Label.Team_Member_Role}"> {!a.TeamMemberRole} </apex:column>
                                                        <apex:column headerValue="{!$Label.Team_Member_Access}"> {!IF(a.OpportunityAccessLevel == 'Read', $Label.Read_Only, $Label.Read_Write)} </apex:column>
                                                    </apex:pageblockTable>
                                                </apex:pageBlockSectionItem>
                                            </apex:pageblocksection>
                                             <apex:pageblockbuttons location="Bottom" rendered="{!reselleroppTeamEdit}">
                                              
                                               <apex:commandButton onclick="refreshPage()"  Value="{!$Label.Back_to_Opportunity}" />
                                                  
                                                <script>
                                                      function refreshPage(){
                                                      if( (typeof sforce != 'undefined') && (sforce != null) ) {
                                                         callGoBack();
                                                         console.log("Action Function Has Called");
                                                        }
                                                        else{
                                                         window.opener.parent.location.href = "/{!$CurrentPage.parameters.id}";
                                                          window.close();
                                                        } 
                                                        }
                                               </script>
                                            </apex:pageblockbuttons>
                                           <apex:pageBlockSection id="editSec" title="{!$Label.Edit_Opp_Team}" collapsible="false" rendered="{!!reselleroppTeamEdit}" > 
                                                <apex:pageBlockSection id="infoSec" title="{!$Label.Deal_Auto_Approval_Failed_Then_Manual_Title}" columns="2">
                                                    <apex:outputText style="font-weight: bold;" value="{!$Label.Opportunity}"/>
                                                    <apex:outputLabel value="{!oppTeamMember.opportunity.Name}"/>
                                                    <apex:outputText style="font-weight: bold;" value="{!$Label.CMAP_User}"/>
                                                    <apex:outputLabel value="{!oppTeamMember.User.Name}"/>
                                                    <apex:outputText style="font-weight: bold;" value="{!$Label.Team_Role}"/>
                                                    <apex:outputLabel value="{!oppTeamMember.TeamMemberRole}"/>
                                                    <apex:outputLabel style="font-weight: bold;" value="{!$Label.Opportunity_Access}"/>
                                                    <apex:selectList value="{!resellerselectedAccess}" size="1">
                                                        <apex:selectOption itemLabel="{!$Label.Read_Only}" ItemValue="Read"/>
                                                        <apex:selectOption itemLabel="{!$Label.Read_Write}" ItemValue="Edit"/>
                                                    </apex:selectList>                                                
                                                </apex:pageBlockSection> 
                                            </apex:pageBlockSection>
                                            <apex:pageblockbuttons location="Bottom" rendered="{!!reselleroppTeamEdit}" >
                                                <apex:commandButton value="{!$Label.CMAP_Save}" action="{!updateTeamrole}"  />
                                                     
                                                 <apex:commandButton value="{!$Label.cancel}" action="{!cancel}"  />
                                                  
                                            </apex:pageblockbuttons>
                                        </apex:pageBlock>
                                    </apex:outputPanel>
                                    <apex:outputPanel >
                                        <!--   <apex:pageMessages id="errorMsgggggg" escape="false"  /> -->
                                        <apex:outputPanel id="resellerresults">
                                            <apex:pageblock rendered="{!showContactTable}" >
                                                <apex:pageBlockSection columns="1" title="{!$Label.search_results}" collapsible="false" >
                                                    <apex:pageblocktable value="{!ConList}" var="c" styleClass="dataTable" >
                                                        <apex:column headervalue="{!$Label.AVS_Field_Select}">
                                                            <apex:inputCheckbox value="{!c.isresellerSelected}"/>
                                                        </apex:column>
                                                        <apex:column headerValue="{!$Label.CMAP_Name}"> {!c.contactName}</apex:column>
                                                        <apex:column headerValue="{!$Label.CMAP_AccountName}">{!c.contactAccName}</apex:column>
                                                        <apex:column headerValue="{!$Label.Contact_CDG_Page_Phone}">{!c.contactPhone}</apex:column>
                                                        <apex:column headerValue="{!$Label.Contact_CDG_Page_Mobile}">{!c.contactMobilePhone}</apex:column>
                                                        <apex:column headerValue="{!$Label.Contact_CDG_Page_Email}">{!c.contactEmail}</apex:column>
                                                        <apex:column headerValue="{!$Label.T2D_Title_field}">{!c.contactTitle}</apex:column>
                                                        <apex:column headerValue="{!$Label.Permission}">
                                                            <apex:selectList value="{!c.resellerassignedPermission}" size="1">
                                                                <apex:selectOption itemValue="Read" itemLabel="{!$Label.Read_Only}"/>
                                                                <apex:selectOption itemValue="Write" itemLabel="{!$Label.Read_Write}"/>
                                                            </apex:selectList>
                                                        </apex:column>
                                                    </apex:pageblocktable>
                                                </apex:pageBlockSection>
                                                <apex:pageBlockButtons location="Bottom">
                                                    <apex:commandButton value="{! $Label.Add_Reseller_Contact}" onclick="this.onclick=function(){return false;}" action="{!contactAddition}" status="actStatusId5" />
                                                    <apex:actionStatus id="actStatusId5" >
                                                        <apex:facet name="start" >
                                                            <img src="/img/loading.gif" />
                                                        </apex:facet>
                                                    </apex:actionStatus>
                                                </apex:pageBlockButtons>
                                            </apex:pageblock>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:tab>
                            <apex:tab label="{!$Label.Add_Distributor_Contacts}" name="distributorTab" ontabenter="calldistributorcontactAddition()" rendered="{!!hideDistributorContactAddtiontab}">
                                <apex:outputPanel rendered="{!showContctAddtionSection}">
                                    <apex:outputPanel id="pb3" >
                                        <apex:pageBlock title="{! $Label.Add_Distributor_Contact}">
                                            <apex:pageblockSection title="{!$Label.Search_Contact}" collapsible="false" columns="1">
                                                <apex:outputPanel >
                                                  {!$Label.Contact_lookup_message}
                                                </apex:outputPanel>
                                                 <apex:pageblockSectionItem >
                                                     <apex:outputLabel value="{!$Label.Distributor_Account}" />
                                                    <apex:outputlabel value="{!accountName}" /> 
                                                </apex:pageblockSectionItem> 
                                                <apex:pageblockSectionItem >
                                                    <apex:outputLabel value="{!$Label.T2D_Contact}" />
                                                    <apex:actionRegion >
                                                    <apex:actionFunction name="toggleButton1" rerender="distiButtonPanel"/>
                                                    <apex:inputText value="{!distributorcontactSearchString}" disabled="{!isDistiPartneradminchecked}" onkeyup="toggleButton1()" />
                                                    </apex:actionRegion>
                                                </apex:pageblockSectionItem>
                                                <apex:pageblockSectionItem > 
                                              <apex:outputLabel />
                                              <apex:outputlabel >{!$Label.contact_email_suggestions}</apex:outputlabel>
                                           </apex:pageblocksectionitem> 
                                                 <apex:pageBlockSectionItem >
                                                    <apex:outputLabel value="{!$Label.Display_Partner_Admins}"/>
                                                    <apex:inputcheckbox value="{!isDistiPartneradminchecked}" selected="{!isDistiPartneradminchecked}" >
                                                        <apex:actionSupport event="onclick" rerender="pb3" />
                                                     </apex:inputcheckbox>
                                                </apex:pageBlockSectionItem>
                                            </apex:pageblockSection>
                                            <apex:pageblockbuttons location="Bottom">
                                                <apex:outputPanel id="distiButtonPanel">
                                                <apex:commandButton value="{!$Label.CMAP_Search}" action="{!contactSearch}"  reRender="frm,errorMsg" status="actStatusId4" disabled="{!(OR(ISBLANK(distributorcontactSearchString), ''== distributorcontactSearchString))&& NOT(isDistiPartneradminchecked)}" />
                                                </apex:outputPanel>
                                             <apex:actionStatus id="actStatusId4" >
                                               <apex:facet name="start" >
                                                        <img src="/img/loading.gif" />
                                                    </apex:facet>
                                                </apex:actionStatus>
                                            </apex:pageblockbuttons>
                                        </apex:pageBlock>
                                    </apex:outputPanel>
                                    <apex:pageMessages id="errorMsggg" escape="false"  />
                                    <apex:outputPanel rendered="{!showOppTeamSection}">
                                        <apex:pageblock >
                                            <apex:pageBlock id="pb">                                         
                                                <apex:pageblocksection title="{!$Label.opportunity_Team}" collapsible="false" columns="1" id="oppTeamsId">
                                                    <apex:pageBlockSectionItem >
                                                        <apex:outputLabel value="{!$Label.select_tabs_for_contact_addtion}" rendered="{! !IF(distioppTeamEdit == false, true, showAddedContactstable)}" />
                                                    </apex:pageBlockSectionItem>
                                                    <apex:pageBlockSectionItem >
                                                        <apex:pageblockTable value="{!oppTeamMembers}" var="a" styleClass="dataTable" rendered="{!showAddedContactstable}">
                                                            <apex:column headerValue="{!$Label.CMAP_Action}">
                                                                <apex:commandLink value="{!$Label.edit}" action="{!editOppTeamMem}" rerender="pb,editSec" rendered="{!if(isValidProfile, true,(if(a.TeamMemberRole == 'Distributor Contact',isDistiValidUser, if(a.TeamMemberRole ==  'Reseller Contact',isresellerValidUser,false))))}"    >
                                                                    <apex:param name="par" value="{!a.Id}" assignTo="{!distiparamOpportunityId}" />
                                                                </apex:commandLink>
                                                                <apex:commandLink value="  | {!$Label.Remove}" onclick="this.onclick=function(){return false;}" action="{!delRow}" rerender="pb1, frm" rendered="{! isValidProfile || isDistiValidUser || isresellerValidUser }">
                                                                 <apex:param name="par" value="{!a.Id}" assignTo="{!distiparamOpportunityId}" />
                                                                  </apex:commandLink>
                                                            </apex:column>
                                                            <apex:column headerValue="{!$Label.Team_Member}"> {!a.User.Name} </apex:column>
                                                            <!-- <apex:column headerValue="Contact Phone"> {!a.User.Contact.Phone} </apex:column> -->
                                                            <apex:column headerValue="{!$Label.Team_Member_Role}"> {!a.TeamMemberRole} </apex:column>
                                                            <apex:column headerValue="{!$Label.Team_Member_Access}"> {!IF(a.OpportunityAccessLevel == 'Read', $Label.Read_Only, $Label.Read_Write)} </apex:column>
                                                        </apex:pageblockTable>
                                                    </apex:pageBlockSectionItem>
                                                </apex:pageblocksection>
                                              <apex:pageblockbuttons location="Bottom" rendered="{!distioppTeamEdit}" >
                                              <apex:commandButton onclick="refreshPage()"  Value="{!$Label.Back_to_Opportunity}" />
                                                <script>
                                                      function refreshPage(){
                                                      if( (typeof sforce != 'undefined') && (sforce != null) ) {
                                                         callGoBack();
                                                         console.log("Action Function Has Called");
                                                        }
                                                        else{
                                                         window.opener.parent.location.href = "/{!$CurrentPage.parameters.id}";
                                                          window.close();
                                                        } 
                                                        }
                                               </script>
                                             </apex:pageblockbuttons>
                                                 <apex:pageBlockSection id="editSec" title="{!$Label.Edit_Opp_Team}" collapsible="false" rendered="{!!distioppTeamEdit}" > 
                                                    <apex:pageBlockSection id="infoSec" title="{!$Label.Deal_Auto_Approval_Failed_Then_Manual_Title}" columns="2">
                                                        <apex:outputText style="font-weight: bold;" value="{!$Label.Opportunity}"/>
                                                        <apex:outputLabel value="{!oppTeamMember.opportunity.Name}"/>
                                                        <apex:outputText style="font-weight: bold;" value="{!$Label.CMAP_User}"/>
                                                        <apex:outputLabel value="{!oppTeamMember.User.Name}"/>
                                                        <apex:outputText style="font-weight: bold;" value="{!$Label.Team_Role}"/>
                                                        <apex:outputLabel value="{!oppTeamMember.TeamMemberRole}" />
                                                        <apex:outputLabel style="font-weight: bold;" value="{!$Label.Opportunity_Access}"/>
                                                        <apex:selectList value="{!distiselectedAccess}" size="1">
                                                            <apex:selectOption itemLabel="{!$Label.Read_Only}" ItemValue="Read"/>
                                                            <apex:selectOption itemLabel="{!$Label.Read_Write}" ItemValue="Edit"/>
                                                        </apex:selectList>                                                      
                                              </apex:pageBlockSection> 
                                                </apex:pageBlockSection>
                                                <apex:pageblockbuttons location="Bottom" rendered="{!!distioppTeamEdit}" >
                                                      <apex:commandButton value="{!$Label.CMAP_Save}" action="{!updateTeamrole}"  /> 
                                                      <apex:commandButton value="{!$Label.cancel}" action="{!cancel}"  />                                               
                                                </apex:pageblockbuttons>                                                
                                            </apex:pageBlock>
                                            <apex:pageblockbuttons location="Bottom">
                                                <apex:actionStatus id="actStatusId3" >
                                                    <apex:facet name="start" >
                                                        <img src="/img/loading.gif" />
                                                    </apex:facet>
                                                </apex:actionStatus>
                                            </apex:pageblockbuttons>
                                        </apex:pageblock>
                                    </apex:outputPanel>
                                    <apex:outputPanel >
                                        <!--   <apex:pageMessages id="errorMsggg" escape="false"  /> -->
                                        <apex:pageblock rendered="{!showContactTable}">
                                            <apex:pageBlockSection columns="1" title="{!$Label.search_results}" collapsible="false" >
                                                <apex:pageblocktable value="{!ConList}" var="c" styleClass="dataTable" >
                                                    <apex:column headervalue="{!$Label.AVS_Field_Select}">
                                                        <apex:inputCheckbox value="{!c.isdistributorSelected}"/>
                                                    </apex:column>
                                                    <apex:column headerValue="{!$Label.CMAP_Name}"> {!c.contactName}</apex:column>
                                                    <apex:column headerValue="{!$Label.CMAP_AccountName}">{!c.contactAccName}</apex:column>
                                                    <apex:column headerValue="{!$Label.Contact_CDG_Page_Phone}">{!c.contactPhone}</apex:column>
                                                    <apex:column headerValue="{!$Label.Contact_CDG_Page_Mobile}">{!c.contactMobilePhone}</apex:column>
                                                    <apex:column headerValue="{!$Label.Contact_CDG_Page_Email}">{!c.contactEmail}</apex:column>
                                                    <apex:column headerValue="{!$Label.T2D_Title_field}">{!c.contactTitle}</apex:column>
                                                    <apex:column headerValue="{!$Label.Permission}">
                                                        <apex:selectList value="{!c.distributorassignedPermission}" size="1">
                                                            <apex:selectOption itemValue="Read" itemLabel="{!$Label.Read_Only}"/>
                                                            <apex:selectOption itemValue="Write" itemLabel="{!$Label.Read_Write}"/>
                                                        </apex:selectList>
                                                    </apex:column>
                                                </apex:pageblocktable>
                                            </apex:pageBlockSection>
                                            <apex:pageBlockButtons location="Bottom">
                                                <apex:commandButton value="{!$Label.Add_Distributor_Contact}" onclick="this.onclick=function(){return false;}" action="{!contactAddition}" status="actStatusId5" />
                                                <apex:actionStatus id="actStatusId5" >
                                                    <apex:facet name="start" >
                                                        <img src="/img/loading.gif" />
                                                    </apex:facet>
                                                </apex:actionStatus>
                                            </apex:pageBlockButtons>
                                        </apex:pageblock>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:tab>
                        </apex:tabpanel>
                        </apex:outputPanel>
                      <apex:actionFunction name="calldistributorcontactAddition" action="{!distributorcontactAddition}">
                            <apex:param name="p1" value="" assignTo="{!selectedTab}" />
                        </apex:actionFunction>
                        <apex:actionFunction name="callresellercontactAddition" action="{!resellercontactAddition}">
                            <apex:param name="p2" value="" assignTo="{!selectedTab}" />
                        </apex:actionFunction>
                        <apex:actionFunction name="callbacktoAccountSearch" action="{!backtoAccountSearch}">
                            <apex:param name="p3" value="" assignTo="{!selectedTab}" />
                        </apex:actionFunction>
                        <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.PageBlockTableEnhanceResources, 'js/jquery.js')}"></script>
                        <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.PageBlockTableEnhanceResources, 'js/jquery.dataTables.js')}"></script>
                        <script type="text/javascript" language="javascript">
  var j$ = jQuery.noConflict();
  j$('table.dataTable').dataTable({
      sPaginationType: "full_numbers"
  }); 
  </script>           
                </apex:form>
            </apex:page>